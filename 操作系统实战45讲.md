![](https://static001.geekbang.org/resource/image/2c/bd/2c6abcd035e5c83cdd7d356eca26b9bd.jpg?wh=6120*6599)

了解 cpu 的工作模式：实模式（真实的模式），保护模式，长模式。

内存和 cpu 的速度不匹配：诞生了缓存，带来了数据一致性问题，解决思路是MESI协议（修改（Modified）、独占（Exclusive）、共享（Shared）和无效（Invalid））。

并发问题解决：

1.原子变量，在只有 **单个变量全局数据** 的情况下，这种变量非常实用，如全局计数器、状态标志变量等。我们利用了CPU的原子指令实现了一组操作原子变量的函数。

2.中断的控制。当要操作的数据很多的情况下，用原子变量就不适合了。但是我们发现在单核心的CPU，同一时刻只有一个代码执行流，除了响应中断导致代码执行流切换，不会有其它条件会干扰全局数据的操作，所以我们只要在操作全局数据时关闭或者开启中断就行了，为此我们开发了控制中断的函数。

3.自旋锁。由于多核心的CPU出现，控制中断已经失效了，因为 **系统中同时有多个代码执行流**，为了解决这个问题，我们开发了自旋锁，自旋锁要么一下子获取锁，要么循环等待最终获取锁。

4.信号量。如果长时间等待后才能获取数据，在这样的情况下，前面中断控制和自旋锁都不能很好地解决，于是我们开发了信号量。信号量由一套数据结构和函数组成，它能使获取数据的代码执行流进入睡眠，然后在相关条件满足时被唤醒，这样就能让CPU能有时间处理其它任务。所以信号量同时解决了三个问题： **等待、互斥、唤醒。**